# How to Make SQL Queries with Claude: A Step-by-Step Guide

In this tutorial, you'll learn how to use Claude to generate SQL queries from natural language questions. We'll set up a test database, provide its schema to Claude, and demonstrate how it translates human language into executable SQL.

## Prerequisites

Before you begin, ensure you have the following:

1.  An Anthropic API key.
2.  Python installed on your system.

## Step 1: Install and Import Required Libraries

First, install the `anthropic` library and import the necessary modules.

```bash
pip install anthropic
```

```python
import sqlite3
from anthropic import Anthropic

# Set up the Claude API client
client = Anthropic()
MODEL_NAME = "claude-opus-4-1"
```

## Step 2: Create a Test Database

We'll create a simple SQLite database with a sample `employees` table and populate it with data.

```python
# Connect to (or create) the test database
conn = sqlite3.connect("test_db.db")
cursor = conn.cursor()

# Create the employees table
cursor.execute("""
    CREATE TABLE IF NOT EXISTS employees (
        id INTEGER PRIMARY KEY,
        name TEXT,
        department TEXT,
        salary INTEGER
    )
""")

# Insert sample data
sample_data = [
    (1, "John Doe", "Sales", 50000),
    (2, "Jane Smith", "Engineering", 75000),
    (3, "Mike Johnson", "Sales", 60000),
    (4, "Emily Brown", "Engineering", 80000),
    (5, "David Lee", "Marketing", 55000),
]
cursor.executemany("INSERT INTO employees VALUES (?, ?, ?, ?)", sample_data)
conn.commit()
```

## Step 3: Define a Function to Query Claude

Now, create a helper function that sends a natural language question and the database schema to Claude, requesting a SQL query in return.

```python
def ask_claude(query, schema):
    """
    Sends a natural language question to Claude and returns a generated SQL query.

    Args:
        query (str): The natural language question.
        schema (str): The database schema as a formatted string.

    Returns:
        str: The SQL query generated by Claude.
    """
    prompt = f"""Here is the schema for a database:

{schema}

Given this schema, can you output a SQL query to answer the following question? Only output the SQL query and nothing else.

Question: {query}
"""

    response = client.messages.create(
        model=MODEL_NAME,
        max_tokens=2048,
        messages=[{"role": "user", "content": prompt}]
    )
    return response.content[0].text
```

## Step 4: Retrieve and Format the Database Schema

To provide context to Claude, we need to extract the schema from our database and format it clearly.

```python
# Retrieve the schema for the 'employees' table
schema = cursor.execute("PRAGMA table_info(employees)").fetchall()

# Format the schema as a CREATE TABLE statement string
schema_str = (
    "CREATE TABLE EMPLOYEES (\n" +
    "\n".join([f"    {col[1]} {col[2]}" for col in schema]) +
    "\n)"
)
print("Database Schema:")
print(schema_str)
```

**Output:**
```
Database Schema:
CREATE TABLE EMPLOYEES (
    id INTEGER
    name TEXT
    department TEXT
    salary INTEGER
)
```

## Step 5: Generate a SQL Query from a Natural Language Question

Let's test the setup by asking Claude a question about the data.

```python
# Define your natural language question
question = "What are the names and salaries of employees in the Engineering department?"

# Get the SQL query from Claude
sql_query = ask_claude(question, schema_str)
print("\nGenerated SQL Query:")
print(sql_query)
```

**Output:**
```
Generated SQL Query:
SELECT name, salary
FROM EMPLOYEES
WHERE department = 'Engineering';
```

## Step 6: Execute the Generated Query and View Results

Finally, run the SQL query Claude provided against your database to see the results.

```python
# Execute the generated SQL query
results = cursor.execute(sql_query).fetchall()

print("\nQuery Results:")
for row in results:
    print(row)
```

**Output:**
```
Query Results:
('Jane Smith', 75000)
('Emily Brown', 80000)
```

## Step 7: Clean Up

Always remember to close your database connection when finished.

```python
# Close the database connection
conn.close()
```

## Summary

You've successfully built a pipeline that uses Claude to translate natural language questions into SQL queries. The key steps were:

1.  Setting up a Claude client and a local SQLite database.
2.  Creating a function that constructs a precise prompt for Claude, including the database schema.
3.  Extracting, formatting, and providing the schema as context.
4.  Executing the generated SQL to verify the results.

This pattern can be extended to more complex databases and questions, making data querying accessible through natural language.