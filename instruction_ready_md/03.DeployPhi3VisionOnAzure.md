# Deploy and Test the Phi-3-Vision Model on Azure Machine Learning

This guide walks you through deploying Microsoft's Phi-3-Vision model as a production-ready service on Azure Machine Learning. You will create a managed endpoint, configure it correctly, and test it by sending an image to generate Python code.

## Prerequisites

Before you begin, ensure you have:
*   An active Azure subscription.
*   Access to the [Azure Portal](https://portal.azure.com).
*   A tool like [Postman](https://www.postman.com/) or `curl` for testing the API.

## Step 1: Create an Azure Machine Learning Workspace

First, you need an Azure Machine Learning workspace to manage your models and deployments.

1.  Navigate to the Azure Portal and search for "Machine Learning".
2.  Click **Create** and follow the setup wizard.
3.  Provide a unique name for your workspace, select your subscription and resource group, then choose a region.
4.  Review the settings and create the workspace.

> **Tip:** For a detailed, step-by-step creation guide, refer to the official Microsoft documentation: [Quickstart: Create workspace resources](https://learn.microsoft.com/azure/machine-learning/quickstart-create-resources?view=azureml-api-2).

## Step 2: Locate and Select the Phi-3-Vision Model

With your workspace ready, you can browse the model catalog to find Phi-3-Vision.

1.  Inside your Azure Machine Learning workspace, navigate to the **Models** section.
2.  Go to the **Browse catalog** tab. Here you will find a collection of foundation models available for deployment.
3.  Search for or locate the **"Phi-3-Vision"** model in the list and select it to begin the deployment process.

## Step 3: Deploy the Model to an Endpoint

Now, configure the deployment settings to create a live endpoint for your model.

1.  On the model's page, click the **Deploy** button.
2.  In the deployment wizard:
    *   **Endpoint:** Create a new real-time endpoint.
    *   **Name:** Provide a descriptive name for your endpoint (e.g., `phi3-vision-demo`).
    *   **Compute type:** Select **Managed compute**.
    *   **Virtual machine size:** Choose an appropriate VM size. **Note:** Phi-3-Vision benefits from more powerful cloud compute for faster response times. Select a GPU-enabled SKU (like an `NC` or `ND` series) for optimal performance.
    *   Review the other settings (like scaling) and proceed to deploy.

The deployment will take several minutes to complete. You can monitor its progress from the **Endpoints** section of your workspace.

## Step 4: Test the Deployed Model Endpoint

Once the endpoint status is **Healthy**, you can test it by sending a request. You will need two key pieces of information from your endpoint's **Consume** tab:
1.  The **REST endpoint URL** (it will end in `/score`).
2.  The **Primary Key** for authentication.

### Construct the API Request

Phi-3-Vision follows a request format similar to GPT-4-Vision. The model expects a JSON payload with a conversation history and a URL pointing to the image you want to analyze.

**Headers:**
Your HTTP POST request must include the following headers:
*   `Authorization`: Set to `Bearer <YOUR_PRIMARY_KEY>`
*   `azureml-model-deployment`: Set to your deployment name (e.g., `phi3-vision-demo`)
*   `Content-Type`: Set to `application/json`

**Body:**
The request body must be a JSON object with the structure shown below. This example asks the model to act as a Python coding assistant.

```json
{
  "input_data": {
    "input_string": [
      {
        "role": "user",
        "content": [
          {
            "type": "text",
            "text": "You are a Python coding assistant. Please create Python code for this image."
          },
          {
            "type": "image_url",
            "image_url": {
              "url": "https://ajaytech.co/wp-content/uploads/2019/09/index.png"
            }
          }
        ]
      }
    ],
    "parameters": {
      "temperature": 0.6,
      "top_p": 0.9,
      "do_sample": false,
      "max_new_tokens": 2048
    }
  }
}
```

### Send the Test Request

1.  Open your API testing tool (e.g., Postman).
2.  Create a new **POST** request.
3.  Paste your endpoint URL (the `/score` URI) into the address bar.
4.  Add the required headers (`Authorization`, `azureml-model-deployment`, `Content-Type`).
5.  Paste the example JSON payload into the request body.
6.  Click **Send**.

If successful, the response body will contain the generated Python code from the Phi-3-Vision model based on the provided image.

## Conclusion

Congratulations! You have successfully deployed the Phi-3-Vision model to a managed Azure Machine Learning endpoint and validated it with a test API call. You can now integrate this endpoint into applications, combining the power of cloud-based vision-language models with other services.